"use strict";function _toConsumableArray(t){return _arrayWithoutHoles(t)||_iterableToArray(t)||_unsupportedIterableToArray(t)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(t,e):void 0}}function _iterableToArray(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}function _arrayWithoutHoles(t){if(Array.isArray(t))return _arrayLikeToArray(t)}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}var addBtn=document.querySelector('[data-btn="add"]'),formMain=document.querySelector("#form-main"),formChoice=document.querySelector("#form-choice"),choiceItems=document.querySelectorAll("[data-choice]"),textPercentItems=document.querySelectorAll(".form__choice-percent"),formCart=document.querySelector(".form__cart"),continueBtn=document.querySelector("[data-continue]"),inputRadioItems=document.querySelectorAll("[data-choice] input"),deleteBtnAll=document.querySelector("[data-btn='del']"),formPrice=document.querySelector(".form__price"),formSucceed=document.querySelector("#form-succeed"),formError=document.querySelector("#form-error"),btnSubmit=document.querySelector("[data-submit]"),inputEmail=document.querySelector('[data-input="email"]'),mainUrl=window.location.href;function removeGreenClass(){for(var t=0;t<textPercentItems.length;t++)textPercentItems[t].classList.remove("green")}document.body.addEventListener("click",(function(t){var e=t.target,r=e.closest("[data-choice]");if("add"===e.getAttribute("data-btn")&&(formMain.classList.remove("active"),formChoice.classList.add("active")),r)for(var o=0;o<choiceItems.length;o++)if(r===choiceItems[o]){r.querySelector("input").checked=!0;var a=r.querySelector(".form__choice-percent");a&&(removeGreenClass(),a.classList.add("green"))}if("continue"===e.getAttribute("data-btn")){for(var n=0;n<inputRadioItems.length;n++)if(inputRadioItems[n].checked){var c=choiceItems[n].dataset.price,i=choiceItems[n].dataset.cnt;cart.addToCart(c,i),inputRadioItems[n].checked=!1,removeGreenClass()}cart.renderProducts(),formChoice.classList.remove("active"),formMain.classList.add("active")}if("del"===e.dataset.btn){var s=Number(e.dataset.id);cart.removeFromCart(s),cart.renderProducts()}"back"===e.dataset.btn&&(formSucceed.classList.remove("active"),formMain.classList.add("active"),setMainUrl()),"again"===e.dataset.btn&&(formError.classList.remove("active"),formMain.classList.add("active"),setMainUrl())}));var cart={products:[],totalPrice:0,addToCart:function(t,e){for(var r=0;r<e;r++)this.products.push({price:t,id:Math.random()})},setTotalPrice:function(){console.log(cart.totalPrice),this.totalPrice=this.products.reduce((function(t,e){return t+Number(e.price)}),0),formPrice.textContent=this.totalPrice},removeFromCart:function(t){this.products=this.products.filter((function(e){return e.id!==t})),console.log(this.products)},renderProducts:function(){formCart.innerHTML="",this.products.length||formCart.insertAdjacentHTML("afterbegin",this.emptyTemplate());for(var t="",e=0;e<cart.products.length;e++){t+=this.templateProduct(formCart.children.length+(e+1),cart.products[e].id)}this.setTotalPrice(),formCart.insertAdjacentHTML("beforeend",t),console.log(this.products)},templateProduct:function(t,e){return'\n      <div class="form__product">\n          <div class="form__product-header">\n              <h4 class="form__product-title">Product <span class="form__product-number">'.concat(t,'</span></h4>\n              <button class="form__btn form__product-btn" data-btn="del" data-id="').concat(e,'"></button>\n          </div>\n          <div class="form__group">\n            <label>Enter main keyword for the product</label>\n            <input class="form__control" type="text" placeholder="for example, sylicon wine cup">\n          </div>\n          <div class="form__group">\n            <label>Enter link to the similar product as a reference</label>\n            <input class="form__control" type="text" placeholder="https://...">\n          </div>\n      </div>\n    ')},emptyTemplate:function(){return'\n      <div class="form__notice">\n          <h4 class="form__product-title" style="text-align:center;">Please add any products</h4>\n      </div>\n    '}};function formValid(){return 0===inputEmail.value.length?(inputEmail.style.borderColor="red",alert("input Email please"),!1):(inputEmail.style.borderColor="#E1E3EE",!0)}function addQueryToUrl(t){console.log(window.location.href);var e="".concat(mainUrl,"success"===t?"/paymentsuccess":"/paymenterror");history.pushState?window.history.pushState("","","".concat(e)):document.location.href="".concat(e)}function setMainUrl(){history.pushState?window.history.pushState("","","".concat(mainUrl)):document.location.href="".concat(mainUrl)}var typeBtn={load:'<img class="load" src="img/load-icon.svg" alt="snip">',text:'Submit and Pay <span class="form__price">0</span>USD'};formMain.addEventListener("submit",(function(t){if(t.preventDefault(),formValid()){var e=new FormData(formMain);e.append("cart",JSON.stringify(cart.products)),btnSubmit.innerHTML="";new Promise((function(t,r){btnSubmit.innerHTML=typeBtn.load,setTimeout((function(){r(),t(e)}),1e3)})).then((function(t){var e;history.pushState?window.history.pushState("","","/paymentsuccess"):document.location.href="/paymenterror",addQueryToUrl("success"),(e=console).log.apply(e,_toConsumableArray(t)),formMain.classList.remove("active"),formSucceed.classList.add("active")})).catch((function(t){console.log(t),formMain.classList.remove("active"),formError.classList.add("active"),addQueryToUrl("error")})).finally((function(){btnSubmit.innerHTML=typeBtn.text,formPrice=btnSubmit.querySelector(".form__price"),cart.products=[],cart.renderProducts(),formMain.reset()}))}}));